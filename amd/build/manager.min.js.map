{"version":3,"sources":["../src/manager.js"],"names":["define","Ajax","Notification","Templates","Str","SELECTORS","AUTOMATICSENDREGION","TOGGLEAUTOMATICSEND","TEMPLATES","LOADING","AUTOMATICSENDALERT","SERVICES","UPDATEAUTOMATICSEND","toggleAutomaticSend","automaticsendregion","M","util","js_pending","querySelector","dataset","certificateid","automaticsend","newstatus","strings","component","get_strings","then","s","confirm","render","visible","html","innerHTML","call","methodname","args","js_complete","fail","exception","init","document","addEventListener","e","target","matches"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module instantiates the functionality for actions on course certificates.\n *\n * @module      mod_coursecertificate/manager\n * @package     mod_coursecertificate\n * @copyright   2020 Mikel Mart√≠n <mikel@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'core/str'\n], function(\n    Ajax,\n    Notification,\n    Templates,\n    Str\n) {\n\n    /** @type {Object} The list of selectors for the coursecertificate module. */\n    const SELECTORS = {\n        AUTOMATICSENDREGION: \"[data-region='automaticsend-alert']\",\n        TOGGLEAUTOMATICSEND: \"[data-action='toggle-automaticsend']\"\n    },\n    /** @type {Object} The list of templates for the coursecertificate module. */\n    TEMPLATES = {\n        LOADING: 'core/loading',\n        AUTOMATICSENDALERT: 'mod_coursecertificate/automaticsend_alert'\n    },\n    /** @type {Object} The list of services for the coursecertificate module. */\n    SERVICES = {\n        UPDATEAUTOMATICSEND: 'mod_coursecertificate_update_certificate_automaticsend'\n    };\n\n    /**\n     * Toggle the automaticsend setting for coursecertificate.\n     *\n     * @param {Element} automaticsendregion\n     */\n    function toggleAutomaticSend(automaticsendregion) {\n        M.util.js_pending('mod_coursecertificate_toggle_automaticsend');\n        const {certificateid, automaticsend} = automaticsendregion.querySelector(SELECTORS.TOGGLEAUTOMATICSEND).dataset;\n        const newstatus = automaticsend === '0';\n        const strings = newstatus\n        ? [{'key': 'confirmation', component: 'admin'},\n            {'key': 'enableautomaticsend', component: 'coursecertificate'},\n            {'key': 'confirm'},\n            {'key': 'cancel'}]\n        : [{'key': 'confirmation', component: 'admin'},\n            {'key': 'disableautomaticsend', component: 'coursecertificate'},\n            {'key': 'confirm'},\n            {'key': 'cancel'}];\n        // Get strings.\n        Str.get_strings(strings).then((s) => {\n            // Show confirm notification.\n            Notification.confirm(s[0], s[1], s[2], s[3], () => {\n                // Show loading temaplte.\n                Templates.render(TEMPLATES.LOADING, {visible: true}, '')\n                .then((html) => {\n                    automaticsendregion.innerHTML = html;\n                    // Call external API to update automaticsend setting.\n                    return Ajax.call([{\n                        methodname: SERVICES.UPDATEAUTOMATICSEND,\n                        args: {certificateid: certificateid, automaticsend: newstatus}\n                    }])[0];\n                })\n                .then(() => {\n                    // Reload automatic send alert template.\n                    return  Templates.render(\n                        TEMPLATES.AUTOMATICSENDALERT,\n                        {certificateid: certificateid, automaticsend: newstatus},\n                        ''\n                    );\n                })\n                .then((html) => {\n                    automaticsendregion.innerHTML = html;\n                    M.util.js_complete('mod_coursecertificate_toggle_automaticsend');\n                    return null;\n\n                });\n            });\n            return null;\n        }).fail(Notification.exception);\n    }\n\n    return {\n        init: function() {\n            const automaticsendregion = document.querySelector(SELECTORS.AUTOMATICSENDREGION);\n            automaticsendregion.addEventListener('click', (e) => {\n                if (e.target && e.target.matches(SELECTORS.TOGGLEAUTOMATICSEND)) {\n                    toggleAutomaticSend(automaticsendregion);\n                }\n            });\n        }\n    };\n});"],"file":"manager.min.js"}