{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of the mod_coursecertificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module instantiates the functionality for actions on course certificates.\n *\n * @module      mod_coursecertificate/manager\n * @copyright   2020 Mikel Mart√≠n <mikel@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport Notification from 'core/notification';\nimport {get_strings as getStrings} from 'core/str';\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport Pending from 'core/pending';\n\n/** @type {Object} The list of selectors for the coursecertificate module. */\nconst SELECTORS = {\n    AUTOMATICSENDREGION: \"[data-region='automaticsend-alert']\",\n    HIDDENWARNING: \".hidden-warning\",\n    NOAUTOSENDINFO: \".noautosend-info\",\n    REPORTREGION: \"[data-region='issues-report']\",\n    TOGGLEAUTOMATICSEND: \"[data-action='toggle-automaticsend']\",\n    LOADING: \".loading-overlay\"\n},\n/** @type {Object} The list of templates for the coursecertificate module. */\nTEMPLATES = {\n    AUTOMATICSENDALERT: 'mod_coursecertificate/automaticsend_alert',\n    ISSUESREPORT: 'mod_coursecertificate/issues_report'\n},\n/** @type {Object} The list of services for the coursecertificate module. */\nSERVICES = {\n    UPDATEAUTOMATICSEND: 'mod_coursecertificate_update_automaticsend',\n};\n\n/**\n * Show/Hide selector.\n *\n * @param {string} selector\n * @param {boolean} visibile\n */\nfunction setVisibility(selector, visibile) {\n    if (visibile) {\n        document.querySelector(selector).classList.remove('d-none');\n        document.querySelector(selector).classList.remove('invisible');\n    } else {\n        document.querySelector(selector).classList.add('d-none');\n        document.querySelector(selector).classList.add('invisible');\n    }\n}\n\n/**\n * Toggle the automaticsend setting on/off for coursecertificate.\n *\n * @param {Element} automaticsendregion\n */\nfunction toggleAutomaticSend(automaticsendregion) {\n    const {certificateid, automaticsend} =\n        automaticsendregion.querySelector(SELECTORS.TOGGLEAUTOMATICSEND).dataset;\n    const newstatus = automaticsend === '0';\n    const strings = [\n        {'key': 'confirmation', component: 'admin'},\n        {'key': 'confirm', component: 'moodle'},\n        {'key': 'cancel', component: 'moodle'}\n    ];\n    if (newstatus) {\n        strings.push({'key': 'enableautomaticsendpopup', component: 'coursecertificate'});\n    } else {\n        strings.push({'key': 'disableautomaticsend', component: 'coursecertificate'});\n    }\n    getStrings(strings).then((s) => {\n        // Show confirm notification.\n        Notification.confirm(s[0], s[3], s[1], s[2], () => {\n            var pendingPromise = new Pending('mod_coursecertificate/manager:toggleAutomaticSend');\n            // Show loading template.\n            setVisibility(SELECTORS.LOADING, true);\n            // Call to webservice.\n            Ajax.call([{methodname: SERVICES.UPDATEAUTOMATICSEND,\n                args: {id: certificateid, automaticsend: newstatus}}])[0]\n            // Reload automatic send alert template.\n            .then((result) => {\n                let {showhiddenwarning, shownoautosendinfo} = result;\n                Templates.render(TEMPLATES.AUTOMATICSENDALERT,\n                    {certificateid: certificateid, automaticsend: newstatus}, '')\n                    .then((html) => {\n                        automaticsendregion.innerHTML = html;\n                        setVisibility(SELECTORS.HIDDENWARNING, showhiddenwarning);\n                        setVisibility(SELECTORS.NOAUTOSENDINFO, shownoautosendinfo);\n                        return pendingPromise.resolve();\n                    })\n                    .fail(Notification.exception);\n                return null;\n            })\n            .fail(Notification.exception);\n        });\n        return null;\n    }).fail(Notification.exception);\n}\n\n/**\n * Initialise module\n */\nexport function init() {\n    const automaticsendregion = document.querySelector(SELECTORS.AUTOMATICSENDREGION);\n    if (automaticsendregion) {\n        automaticsendregion.addEventListener('click', (e) => {\n            if (e.target && e.target.closest(SELECTORS.TOGGLEAUTOMATICSEND)) {\n                e.preventDefault();\n                toggleAutomaticSend(automaticsendregion);\n            }\n        });\n    }\n}\n"],"names":["automaticsendregion","document","querySelector","SELECTORS","addEventListener","e","target","closest","preventDefault","certificateid","automaticsend","dataset","newstatus","strings","component","push","then","s","confirm","pendingPromise","Pending","setVisibility","call","methodname","SERVICES","args","id","result","showhiddenwarning","shownoautosendinfo","render","TEMPLATES","html","innerHTML","resolve","fail","Notification","exception","toggleAutomaticSend","selector","visibile","classList","remove","add"],"mappings":"wWAsHUA,oBAAsBC,SAASC,cAAcC,+BAC/CH,qBACAA,oBAAoBI,iBAAiB,SAAUC,IACvCA,EAAEC,QAAUD,EAAEC,OAAOC,QAAQJ,iCAC7BE,EAAEG,0BAnDWR,2BACnBS,cAACA,cAADC,cAAgBA,eAClBV,oBAAoBE,cAAcC,+BAA+BQ,QAC/DC,UAA8B,MAAlBF,cACZG,QAAU,CACZ,KAAQ,eAAgBC,UAAW,SACnC,KAAQ,UAAWA,UAAW,UAC9B,KAAQ,SAAUA,UAAW,WAE7BF,UACAC,QAAQE,KAAK,KAAQ,2BAA4BD,UAAW,sBAE5DD,QAAQE,KAAK,KAAQ,uBAAwBD,UAAW,2CAEjDD,SAASG,MAAMC,0BAETC,QAAQD,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI,SACrCE,eAAiB,IAAIC,iBAAQ,qDAEjCC,cAAclB,mBAAmB,iBAE5BmB,KAAK,CAAC,CAACC,WAAYC,6BACpBC,KAAM,CAACC,GAAIjB,cAAeC,cAAeE,cAAc,GAE1DI,MAAMW,aACCC,kBAACA,kBAADC,mBAAoBA,oBAAsBF,iCACpCG,OAAOC,6BACb,CAACtB,cAAeA,cAAeC,cAAeE,WAAY,IACzDI,MAAMgB,OACHhC,oBAAoBiC,UAAYD,KAChCX,cAAclB,wBAAyByB,mBACvCP,cAAclB,yBAA0B0B,oBACjCV,eAAee,aAEzBC,KAAKC,sBAAaC,WAChB,QAEVF,KAAKC,sBAAaC,cAEhB,QACRF,KAAKC,sBAAaC,WAYTC,CAAoBtC,gNA3F9BG,8BACmB,sCADnBA,wBAEa,kBAFbA,yBAGc,mBAHdA,8BAKmB,uCALnBA,kBAMO,mBAGb4B,6BACwB,4CAIxBP,6BACyB,sDAShBH,cAAckB,SAAUC,UACzBA,UACAvC,SAASC,cAAcqC,UAAUE,UAAUC,OAAO,UAClDzC,SAASC,cAAcqC,UAAUE,UAAUC,OAAO,eAElDzC,SAASC,cAAcqC,UAAUE,UAAUE,IAAI,UAC/C1C,SAASC,cAAcqC,UAAUE,UAAUE,IAAI"}